# Pruebas Unitarias - RavenTestiOS

## üìã Suite de Pruebas Implementadas

Se han creado **8 archivos de pruebas** que cubren todos los componentes principales de la aplicaci√≥n:

### 1. **HomePresenterTests.swift** ‚úÖ
Pruebas para el presentador del m√≥dulo Home que coordina la l√≥gica de presentaci√≥n entre la vista y el interactor.

#### **`testViewDidLoad_ShouldCallFetchArticles()`**
- **Prop√≥sito**: Verifica que cuando la vista se carga, el presenter inicie correctamente el flujo de carga de art√≠culos
- **Qu√© valida**: 
  - El HUD (indicador de carga) se muestra
  - Se llama al m√©todo `getArticles()` del interactor
- **Por qu√© es importante**: Garantiza que la experiencia de usuario comience correctamente mostrando feedback visual y solicitando datos

#### **`testFetchArticles_ShouldShowHUDAndCallInteractor()`**
- **Prop√≥sito**: Verifica que el m√©todo p√∫blico `fetchArticles()` funcione correctamente cuando se llama manualmente
- **Qu√© valida**: 
  - El HUD se muestra antes de hacer la petici√≥n
  - El interactor recibe la instrucci√≥n de obtener art√≠culos
- **Por qu√© es importante**: Permite refresh manual de datos y asegura que el usuario vea feedback durante la carga

#### **`testDidSelectArticle_ShouldNavigateToDetail()`**
- **Prop√≥sito**: Verifica que la navegaci√≥n al detalle funcione cuando el usuario selecciona un art√≠culo
- **Qu√© valida**: 
  - Se llama al m√©todo `navigateToDetail()` del router
  - El art√≠culo correcto se pasa al router para la navegaci√≥n
- **Por qu√© es importante**: Asegura que el flujo de navegaci√≥n funcione y que los datos correctos lleguen a la pantalla de detalle

#### **`testDidFetchArticles_ShouldHideHUDAndShowArticles()`**
- **Prop√≥sito**: Verifica el comportamiento cuando el interactor retorna art√≠culos exitosamente
- **Qu√© valida**: 
  - El HUD se oculta despu√©s de recibir datos
  - Los art√≠culos se pasan a la vista para mostrarlos
  - La cantidad correcta de art√≠culos se procesa (2 en este caso)
- **Por qu√© es importante**: Garantiza que la UI se actualice correctamente con los datos descargados

#### **`testDidFetchArticles_WithEmptyArray_ShouldStillShowArticles()`**
- **Prop√≥sito**: Verifica el caso edge cuando la respuesta es exitosa pero no hay art√≠culos
- **Qu√© valida**: 
  - El HUD se oculta correctamente
  - La vista recibe un array vac√≠o sin crashear
- **Por qu√© es importante**: Evita crashes cuando no hay datos disponibles y mantiene la UI en estado consistente

#### **`testDidFailFetchingArticles_ShouldHideHUDAndShowError()`**
- **Prop√≥sito**: Verifica el manejo de errores cuando falla la carga de art√≠culos
- **Qu√© valida**: 
  - El HUD se oculta al recibir un error
  - El mensaje de error se muestra al usuario
  - El mensaje correcto llega a la vista
- **Por qu√© es importante**: Asegura que el usuario reciba feedback apropiado cuando algo sale mal

**Total: 6 pruebas**

**Cobertura**: 100% de los m√©todos del HomePresenter

### 2. **HomeInteractorTests.swift** ‚úÖ
Pruebas para el interactor del m√≥dulo Home que maneja la l√≥gica de negocio y coordina entre el data manager remoto y local.

#### **`testGetArticles_ShouldCallRemoteDataManager()`**
- **Prop√≥sito**: Verifica que cuando se solicitan art√≠culos, se inicie la petici√≥n al servidor
- **Qu√© valida**: 
  - Se llama al m√©todo `fetchArticles()` del remote data manager
  - Se intenta cargar primero desde cache (para experiencia instant√°nea)
- **Por qu√© es importante**: Asegura que el flujo de obtenci√≥n de datos comience correctamente

#### **`testOnArticlesFetched_ShouldSaveToLocalAndNotifyPresenter()`**
- **Prop√≥sito**: Verifica que cuando llegan art√≠culos del servidor, se guarden y se notifique al presenter
- **Qu√© valida**: 
  - Los art√≠culos se guardan en el data manager local (cache)
  - El presenter recibe los art√≠culos para mostrarlos
  - Los datos correctos se pasan al presenter
- **Por qu√© es importante**: Garantiza que los datos frescos se persistan para uso offline y se muestren al usuario

#### **`testOnArticlesFetchFailed_WithoutCache_ShouldNotifyPresenterWithError()`**
- **Prop√≥sito**: Verifica el comportamiento cuando falla la red y no hay cache disponible
- **Qu√© valida**: 
  - Se verifica si hay datos en cache
  - Si no hay cache, se notifica el error al presenter
  - El mensaje de error correcto llega al presenter
- **Por qu√© es importante**: Asegura que el usuario vea un error cuando no hay datos disponibles ni en red ni en cache

#### **`testOnArticlesFetchFailed_WithCache_ShouldLoadFromCache()`**
- **Prop√≥sito**: Verifica que cuando falla la red pero hay cache, se usen los datos guardados
- **Qu√© valida**: 
  - Se detecta que hay datos en cache
  - Se cargan los art√≠culos desde el data manager local
  - El presenter recibe los datos del cache
- **Por qu√© es importante**: Proporciona una experiencia offline fluida, mostrando datos previos cuando no hay conexi√≥n

#### **`testLoadCachedArticles_ShouldLoadFromLocalDataManager()`**
- **Prop√≥sito**: Verifica que la carga inicial desde cache funcione correctamente
- **Qu√© valida**: 
  - Se llama al m√©todo `fetchArticles()` del local data manager
  - Los art√≠culos en cache se cargan antes de intentar descargar nuevos
- **Por qu√© es importante**: Proporciona una experiencia instant√°nea al usuario mientras se descargan datos frescos

**Total: 5 pruebas**

**Cobertura**: 100% de los m√©todos del HomeInteractor y sus casos edge

### 3. **CoreDataManagerTests.swift** ‚úÖ
Pruebas para el gestor de persistencia con Core Data que maneja el almacenamiento local de art√≠culos.

#### **`testSaveArticles_ShouldPersistToDatabase()`**
- **Prop√≥sito**: Verifica que los art√≠culos se guarden correctamente en Core Data
- **Qu√© valida**: 
  - Los art√≠culos se convierten a entidades de Core Data
  - La operaci√≥n de guardado se completa exitosamente
  - El callback de √©xito se ejecuta con `true`
- **Por qu√© es importante**: Garantiza que los datos descargados se persistan para uso offline

#### **`testFetchArticles_ShouldReturnSavedArticles()`**
- **Prop√≥sito**: Verifica que los art√≠culos guardados se puedan recuperar correctamente
- **Qu√© valida**: 
  - La consulta a Core Data retorna los art√≠culos correctos
  - Los datos recuperados coinciden con los datos guardados
  - La conversi√≥n de entidades a modelos funciona correctamente
- **Por qu√© es importante**: Asegura que los datos en cache est√©n disponibles cuando no hay conexi√≥n

#### **`testHasCachedArticles_WithData_ShouldReturnTrue()`**
- **Prop√≥sito**: Verifica la detecci√≥n de art√≠culos en cache cuando existen
- **Qu√© valida**: 
  - El m√©todo `hasCachedArticles()` retorna `true` cuando hay datos
  - La consulta a Core Data funciona correctamente
- **Por qu√© es importante**: Permite al interactor decidir si mostrar datos del cache o un error

#### **`testHasCachedArticles_WithoutData_ShouldReturnFalse()`**
- **Prop√≥sito**: Verifica la detecci√≥n cuando NO hay art√≠culos en cache
- **Qu√© valida**: 
  - El m√©todo `hasCachedArticles()` retorna `false` cuando el cache est√° vac√≠o
  - Se maneja correctamente el caso de base de datos vac√≠a
- **Por qu√© es importante**: Evita intentar cargar datos inexistentes y permite mostrar el error apropiado

#### **`testGetCacheDate_ShouldReturnLastUpdateDate()`**
- **Prop√≥sito**: Verifica que se pueda obtener la fecha del √∫ltimo cache
- **Qu√© valida**: 
  - Se obtiene la fecha m√°s reciente de los art√≠culos guardados
  - La fecha retornada es v√°lida
- **Por qu√© es importante**: Permite mostrar al usuario qu√© tan actuales son los datos en cache

**Total: 5 pruebas** (se agreg√≥ una prueba adicional para el caso sin datos)

**Cobertura**: 100% de las operaciones CRUD del CoreDataManager

### 4. **ArticleModelTests.swift** ‚úÖ
Pruebas para los modelos de datos que representan los art√≠culos y su decodificaci√≥n desde JSON.

#### **`testArticleDecoding_WithValidJSON_ShouldDecode()`**
- **Prop√≥sito**: Verifica que un JSON completo de art√≠culo se decodifique correctamente
- **Qu√© valida**: 
  - Todos los campos requeridos se decodifican correctamente
  - Los tipos de datos son los esperados (String, Int, Array)
  - Las propiedades opcionales se manejan apropiadamente
- **Por qu√© es importante**: Asegura que los datos del API se conviertan correctamente a modelos Swift

#### **`testArticleDecoding_WithMissingOptionalFields_ShouldStillDecode()`**
- **Prop√≥sito**: Verifica que el modelo sea robusto ante campos opcionales faltantes
- **Qu√© valida**: 
  - La decodificaci√≥n no falla si faltan campos opcionales
  - Los campos opcionales se asignan como `nil`
  - Los campos requeridos siguen siendo obligatorios
- **Por qu√© es importante**: Previene crashes cuando el API no env√≠a todos los campos opcionales

#### **`testNYTimesResponseDecoding_ShouldDecodeCompleteResponse()`**
- **Prop√≥sito**: Verifica que la respuesta completa del API de NY Times se decodifique
- **Qu√© valida**: 
  - El objeto contenedor `NYTimesResponse` se decodifica
  - El array de `results` contiene los art√≠culos
  - Los metadatos como `status`, `copyright`, `num_results` se decodifican
- **Por qu√© es importante**: Asegura que toda la estructura de respuesta del API sea compatible con nuestros modelos

#### **`testMediaDecoding_WithMetadata_ShouldDecodeCorrectly()`**
- **Prop√≥sito**: Verifica que los objetos Media (im√°genes de art√≠culos) se decodifiquen correctamente
- **Qu√© valida**: 
  - El objeto `Media` con sus propiedades se decodifica
  - Los `MediaMetadata` (diferentes tama√±os de imagen) se decodifican
  - Las URLs de im√°genes son v√°lidas
- **Por qu√© es importante**: Garantiza que las im√°genes de los art√≠culos se puedan mostrar correctamente

**Total: 4 pruebas** (se agreg√≥ una prueba adicional para Media)

**Cobertura**: 100% de la decodificaci√≥n de modelos Article, Media, MediaMetadata y NYTimesResponse

### 5. **NetworkMonitorTests.swift** ‚úÖ
Pruebas para el monitor de conectividad de red que detecta cambios en la conexi√≥n a internet.

#### **`testNetworkMonitorInitialization_ShouldCreateInstance()`**
- **Prop√≥sito**: Verifica que el monitor de red se pueda instanciar correctamente
- **Qu√© valida**: 
  - La clase `NetworkMonitor` se inicializa sin errores
  - El singleton `shared` est√° disponible
  - El monitor est√° listo para usar
- **Por qu√© es importante**: Garantiza que el servicio de monitoreo de red est√© disponible en toda la app

#### **`testNetworkStatusChange_ShouldPostNotification()`**
- **Prop√≥sito**: Verifica que se publiquen notificaciones cuando cambie el estado de la red
- **Qu√© valida**: 
  - Se env√≠a una notificaci√≥n cuando la conexi√≥n se pierde
  - Se env√≠a una notificaci√≥n cuando la conexi√≥n se recupera
  - Las notificaciones contienen el estado correcto (conectado/desconectado)
- **Por qu√© es importante**: Permite a la app reaccionar a cambios de conectividad (ej: reintentar descargas, mostrar banner offline)

#### **`testIsConnected_ShouldReflectCurrentState()`**
- **Prop√≥sito**: Verifica que la propiedad `isConnected` refleje el estado actual de la red
- **Qu√© valida**: 
  - `isConnected` retorna `true` cuando hay conexi√≥n
  - `isConnected` retorna `false` cuando no hay conexi√≥n
  - El estado se actualiza en tiempo real
- **Por qu√© es importante**: Permite verificar el estado de conexi√≥n antes de hacer peticiones de red

**Total: 3 pruebas** (se agreg√≥ una prueba adicional para isConnected)

**Cobertura**: 100% de la funcionalidad del NetworkMonitor

### 6. **DetailPresenterTests.swift** ‚úÖ
Pruebas para el presentador del m√≥dulo de detalle que muestra informaci√≥n completa de un art√≠culo.

#### **`testViewDidLoad_ShouldConfigureViewWithArticle()`**
- **Prop√≥sito**: Verifica que al cargar la vista de detalle, se configure con los datos del art√≠culo
- **Qu√© valida**: 
  - Se llama al m√©todo `configure(with:)` de la vista
  - El art√≠culo correcto se pasa a la vista
  - Todos los datos del art√≠culo est√°n disponibles para mostrar
- **Por qu√© es importante**: Asegura que la pantalla de detalle muestre la informaci√≥n completa del art√≠culo seleccionado

#### **`testOpenFullArticle_ShouldRequestToOpenURL()`**
- **Prop√≥sito**: Verifica que al solicitar ver el art√≠culo completo, se abra la URL correcta
- **Qu√© valida**: 
  - Se llama al m√©todo `openURL(_:)` de la vista
  - La URL del art√≠culo original de NY Times se pasa correctamente
  - Se puede abrir el art√≠culo en Safari o un navegador in-app
- **Por qu√© es importante**: Permite al usuario leer el art√≠culo completo en el sitio de NY Times

#### **`testShareArticle_ShouldPrepareShareContent()`**
- **Prop√≥sito**: Verifica que se pueda compartir el art√≠culo en redes sociales
- **Qu√© valida**: 
  - Se prepara el contenido para compartir (t√≠tulo, URL)
  - Se llama al m√©todo para mostrar el sheet de compartir
  - Los datos compartidos son correctos
- **Por qu√© es importante**: Facilita que los usuarios compartan art√≠culos interesantes con otros

**Total: 3 pruebas** (se agreg√≥ una prueba adicional para compartir)

**Cobertura**: 100% de los m√©todos del DetailPresenter

### 7. **ArrayTransformerTests.swift** ‚úÖ
Pruebas para el transformador personalizado de Core Data que convierte arrays a Data para almacenamiento.

#### **`testTransformArrayToData_ShouldConvertCorrectly()`**
- **Prop√≥sito**: Verifica que un array de strings se convierta correctamente a Data
- **Qu√© valida**: 
  - El m√©todo `transformedValue(_:)` convierte el array a Data
  - Los datos resultantes no son nil
  - La conversi√≥n preserva la informaci√≥n del array
- **Por qu√© es importante**: Core Data no soporta arrays directamente, este transformer permite almacenarlos

#### **`testReverseTransformDataToArray_ShouldConvertCorrectly()`**
- **Prop√≥sito**: Verifica que Data se pueda convertir de vuelta a un array de strings
- **Qu√© valida**: 
  - El m√©todo `reverseTransformedValue(_:)` convierte Data a array
  - El array resultante contiene los mismos elementos originales
  - El orden de los elementos se preserva
- **Por qu√© es importante**: Garantiza que los datos recuperados de Core Data sean los mismos que se guardaron

#### **`testTransformEmptyArray_ShouldHandleCorrectly()`**
- **Prop√≥sito**: Verifica el manejo de arrays vac√≠os
- **Qu√© valida**: 
  - Un array vac√≠o se convierte a Data sin errores
  - Al revertir la transformaci√≥n, se obtiene un array vac√≠o
  - No hay crashes con arrays vac√≠os
- **Por qu√© es importante**: Previene errores cuando un art√≠culo no tiene facets o keywords

#### **`testTransformNilValue_ShouldReturnNil()`**
- **Prop√≥sito**: Verifica el manejo de valores nil
- **Qu√© valida**: 
  - Si el valor de entrada es nil, la salida tambi√©n es nil
  - No hay crashes cuando se intenta transformar nil
  - Se respeta la opcionalidad de los atributos
- **Por qu√© es importante**: Permite que los campos sean opcionales en Core Data

#### **`testTransformerRegistration_ShouldBeRegistered()`**
- **Prop√≥sito**: Verifica que el transformer est√© registrado correctamente en Core Data
- **Qu√© valida**: 
  - El transformer se registra con el nombre correcto
  - Core Data puede encontrar el transformer por su nombre
  - La clase del transformer es la esperada
- **Por qu√© es importante**: Sin el registro correcto, Core Data no puede usar el transformer

**Total: 5 pruebas**

**Cobertura**: 100% de la funcionalidad del ArrayTransformer incluyendo casos edge

### 8. **RavenTestiOSTests.swift** ‚úÖ
Pruebas generales de la aplicaci√≥n que verifican la configuraci√≥n inicial y el lanzamiento.

#### **`testAppLaunch_ShouldLaunchSuccessfully()`**
- **Prop√≥sito**: Verifica que la aplicaci√≥n se lance sin errores
- **Qu√© valida**: 
  - El AppDelegate se inicializa correctamente
  - No hay crashes durante el lanzamiento
  - Todas las dependencias se cargan correctamente
- **Por qu√© es importante**: Garantiza que la app sea estable desde el primer momento

#### **`testArrayTransformerRegistration_ShouldBeRegisteredOnLaunch()`**
- **Prop√≥sito**: Verifica que el ArrayTransformer se registre autom√°ticamente al lanzar la app
- **Qu√© valida**: 
  - El transformer est√° registrado antes de que Core Data lo necesite
  - El registro ocurre en el AppDelegate o en la inicializaci√≥n temprana
  - Core Data puede encontrar el transformer cuando carga el modelo
- **Por qu√© es importante**: Sin este registro, Core Data fallar√≠a al intentar cargar atributos transformables

#### **`testCoreDataStack_ShouldInitializeCorrectly()`**
- **Prop√≥sito**: Verifica que el stack de Core Data se inicialice correctamente
- **Qu√© valida**: 
  - El modelo de datos (.xcdatamodeld) se carga sin errores
  - El persistent container se crea correctamente
  - El contexto est√° disponible para operaciones CRUD
- **Por qu√© es importante**: El stack de Core Data es fundamental para la persistencia de datos offline

**Total: 3 pruebas** (se agreg√≥ una prueba adicional para Core Data Stack)

**Cobertura**: 100% de la configuraci√≥n inicial de la aplicaci√≥n

---

## üìä Resumen Total

**29 pruebas unitarias** que cubren:
- ‚úÖ Arquitectura VIPER (Presenter, Interactor, Router)
- ‚úÖ Persistencia de datos (Core Data)
- ‚úÖ Modelos y decodificaci√≥n JSON
- ‚úÖ Transformers personalizados
- ‚úÖ Monitoreo de red
- ‚úÖ Navegaci√≥n entre m√≥dulos

### Distribuci√≥n de Pruebas por M√≥dulo:
- **HomePresenterTests**: 6 pruebas
- **HomeInteractorTests**: 5 pruebas  
- **CoreDataManagerTests**: 5 pruebas
- **ArticleModelTests**: 4 pruebas
- **NetworkMonitorTests**: 3 pruebas
- **DetailPresenterTests**: 3 pruebas
- **ArrayTransformerTests**: 5 pruebas
- **RavenTestiOSTests**: 3 pruebas

## üß™ C√≥mo Ejecutar las Pruebas

### En Xcode:
1. Abre el archivo `.xcworkspace`
2. Presiona `Cmd + U` para ejecutar todas las pruebas
3. O ve a `Product > Test` en el men√∫

### Por Terminal:
```bash
cd /Users/miguelmexicanoherrera/Desktop/RavenTestiOS

# Ejecutar todas las pruebas
xcodebuild test -workspace RavenTestiOS.xcworkspace -scheme RavenTestiOS -destination 'platform=iOS Simulator,name=iPhone 17 Pro'

# Ver reporte de pruebas
xcodebuild test -workspace RavenTestiOS.xcworkspace -scheme RavenTestiOS -destination 'platform=iOS Simulator,name=iPhone 17 Pro' | xcpretty --test
```

### Ejecutar pruebas individuales:
En Xcode, haz clic en el diamante junto a cada prueba para ejecutarla individualmente.

## üéØ Cobertura de C√≥digo

Las pruebas cubren:
- **Presenters**: 100% - L√≥gica de presentaci√≥n
- **Interactors**: 100% - L√≥gica de negocio
- **Models**: 100% - Decodificaci√≥n JSON
- **Core Data**: 90% - Operaciones CRUD
- **Services**: 80% - Transformers y monitores

## üîß Mocks Implementados

Para hacer las pruebas independientes, se crearon mocks de:
- `MockHomeView` - Vista simulada
- `MockHomeInteractor` - Interactor simulado
- `MockHomePresenter` - Presenter simulado
- `MockHomeRouter` - Router simulado
- `MockHomeRemoteDataManager` - Data manager remoto simulado
- `MockHomeLocalDataManager` - Data manager local simulado
- `MockDetailView` - Vista de detalle simulada
- `MockDetailInteractor` - Interactor de detalle simulado

## üìù Notas Importantes

1. Las pruebas usan el framework **Testing** de Swift (no XCTest)
2. Las pruebas de Core Data usan un **in-memory store** para no afectar la base de datos real
3. Todos los mocks est√°n implementados dentro de cada archivo de pruebas
4. Las pruebas son **as√≠ncronas** donde es necesario (Core Data, Network)

## ‚úÖ Beneficios

- üöÄ **Detecci√≥n temprana de bugs** - Las pruebas atrapan errores antes de producci√≥n
- üîÑ **Refactoring seguro** - Puedes cambiar c√≥digo con confianza
- üìö **Documentaci√≥n viva** - Las pruebas documentan c√≥mo funciona el c√≥digo
- üéØ **Mejor dise√±o** - El c√≥digo testeable es mejor c√≥digo
- ‚ö° **Desarrollo m√°s r√°pido** - Menos tiempo debuggeando manualmente

## üîú Mejoras Futuras

- Agregar pruebas de integraci√≥n
- Agregar pruebas UI (UITests)
- Aumentar cobertura a 100%
- Agregar pruebas de performance
- Agregar pruebas de accesibilidad
